{"version":3,"sources":["../../src/utils/enhanceFields.ts"],"sourcesContent":["import type { Field } from 'payload'\n\nimport type { PluginContext } from './createPluginContext.js'\n\nimport {\n  createLocalizedSlugsField,\n  createLocalizedUrlField,\n  createPermalinkField,\n  createSlugField,\n  createUrlField,\n} from '../fields/index.js'\n\nexport const enhanceFields = ({ context, fields }: { context: PluginContext; fields: Field[] }) => {\n  let updatedFields = [...fields] // Start with a copy of the existing fields\n\n  // Create index for fast lookups\n  const indexedFields = fields.reduce(\n    (index, field) => {\n      if ('name' in field && typeof field.name === 'string') {\n        index[field.name] = field\n      }\n      return index\n    },\n    {} as Record<string, Field>,\n  )\n\n  const addFields = (newFields: Field[]) => {\n    newFields.forEach((field) => {\n      if ('name' in field && typeof field.name === 'string') {\n        if (!indexedFields[field.name]) {\n          updatedFields.push(field)\n          indexedFields[field.name] = field\n        }\n      } else {\n        console.warn('Field without a name encountered. Skipping:', field)\n      }\n    })\n  }\n\n  const {\n    localizedSlugFieldConfig,\n    localizedUrlFieldConfig,\n    permalinkFieldConfig,\n    slugFieldConfig,\n    urlFieldConfig,\n  } = context.fieldConfigs\n\n  // Add slug fields\n  if (!indexedFields[slugFieldConfig.fieldName]) {\n    const slugFields = createSlugField({ context, fieldConfig: slugFieldConfig })\n    addFields(slugFields) // Handles multiple slug-related fields\n  }\n\n  // Add localized slug fields\n  if (!indexedFields[localizedSlugFieldConfig.fieldName]) {\n    const localizedField = createLocalizedSlugsField({\n      context,\n      fieldConfig: localizedSlugFieldConfig,\n    })\n    addFields([localizedField])\n  }\n\n  // Add URL fields\n  if (!indexedFields[urlFieldConfig.fieldName]) {\n    const field = createUrlField({ context, fieldConfig: urlFieldConfig })\n    addFields([field])\n  }\n\n  // Add Localized URL field\n  if (!indexedFields[localizedUrlFieldConfig.fieldName]) {\n    const field = createLocalizedUrlField({ context, fieldConfig: localizedUrlFieldConfig })\n    addFields([field])\n  }\n\n  if (context.permalinkEnabled && !indexedFields[permalinkFieldConfig.fieldName]) {\n    const field = createPermalinkField({ context, fieldConfig: permalinkFieldConfig })\n\n    updatedFields = [field, ...updatedFields]\n  }\n\n  return updatedFields\n}\n"],"names":["createLocalizedSlugsField","createLocalizedUrlField","createPermalinkField","createSlugField","createUrlField","enhanceFields","context","fields","updatedFields","indexedFields","reduce","index","field","name","addFields","newFields","forEach","push","console","warn","localizedSlugFieldConfig","localizedUrlFieldConfig","permalinkFieldConfig","slugFieldConfig","urlFieldConfig","fieldConfigs","fieldName","slugFields","fieldConfig","localizedField","permalinkEnabled"],"mappings":"AAIA,SACEA,yBAAyB,EACzBC,uBAAuB,EACvBC,oBAAoB,EACpBC,eAAe,EACfC,cAAc,QACT,qBAAoB;AAE3B,OAAO,MAAMC,gBAAgB,CAAC,EAAEC,OAAO,EAAEC,MAAM,EAA+C;IAC5F,IAAIC,gBAAgB;WAAID;KAAO,CAAC,2CAA2C;;IAE3E,gCAAgC;IAChC,MAAME,gBAAgBF,OAAOG,MAAM,CACjC,CAACC,OAAOC;QACN,IAAI,UAAUA,SAAS,OAAOA,MAAMC,IAAI,KAAK,UAAU;YACrDF,KAAK,CAACC,MAAMC,IAAI,CAAC,GAAGD;QACtB;QACA,OAAOD;IACT,GACA,CAAC;IAGH,MAAMG,YAAY,CAACC;QACjBA,UAAUC,OAAO,CAAC,CAACJ;YACjB,IAAI,UAAUA,SAAS,OAAOA,MAAMC,IAAI,KAAK,UAAU;gBACrD,IAAI,CAACJ,aAAa,CAACG,MAAMC,IAAI,CAAC,EAAE;oBAC9BL,cAAcS,IAAI,CAACL;oBACnBH,aAAa,CAACG,MAAMC,IAAI,CAAC,GAAGD;gBAC9B;YACF,OAAO;gBACLM,QAAQC,IAAI,CAAC,+CAA+CP;YAC9D;QACF;IACF;IAEA,MAAM,EACJQ,wBAAwB,EACxBC,uBAAuB,EACvBC,oBAAoB,EACpBC,eAAe,EACfC,cAAc,EACf,GAAGlB,QAAQmB,YAAY;IAExB,kBAAkB;IAClB,IAAI,CAAChB,aAAa,CAACc,gBAAgBG,SAAS,CAAC,EAAE;QAC7C,MAAMC,aAAaxB,gBAAgB;YAAEG;YAASsB,aAAaL;QAAgB;QAC3ET,UAAUa,YAAY,uCAAuC;;IAC/D;IAEA,4BAA4B;IAC5B,IAAI,CAAClB,aAAa,CAACW,yBAAyBM,SAAS,CAAC,EAAE;QACtD,MAAMG,iBAAiB7B,0BAA0B;YAC/CM;YACAsB,aAAaR;QACf;QACAN,UAAU;YAACe;SAAe;IAC5B;IAEA,iBAAiB;IACjB,IAAI,CAACpB,aAAa,CAACe,eAAeE,SAAS,CAAC,EAAE;QAC5C,MAAMd,QAAQR,eAAe;YAAEE;YAASsB,aAAaJ;QAAe;QACpEV,UAAU;YAACF;SAAM;IACnB;IAEA,0BAA0B;IAC1B,IAAI,CAACH,aAAa,CAACY,wBAAwBK,SAAS,CAAC,EAAE;QACrD,MAAMd,QAAQX,wBAAwB;YAAEK;YAASsB,aAAaP;QAAwB;QACtFP,UAAU;YAACF;SAAM;IACnB;IAEA,IAAIN,QAAQwB,gBAAgB,IAAI,CAACrB,aAAa,CAACa,qBAAqBI,SAAS,CAAC,EAAE;QAC9E,MAAMd,QAAQV,qBAAqB;YAAEI;YAASsB,aAAaN;QAAqB;QAEhFd,gBAAgB;YAACI;eAAUJ;SAAc;IAC3C;IAEA,OAAOA;AACT,EAAC"}