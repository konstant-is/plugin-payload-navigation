{"version":3,"sources":["../../src/hooks/resolveUrl.ts"],"sourcesContent":["import type { CollectionBeforeChangeHook } from 'payload'\n\nimport type { AppendLocaleToUrlOptions, NavigationPluginConfig, UrlFieldConfig } from '../types.js'\n\nimport { DEFAULT_LOCALE } from '../constants.js'\n\nexport const resolveUrl =\n  (pluginConfig: NavigationPluginConfig, config: UrlFieldConfig): CollectionBeforeChangeHook =>\n  ({ data, req }) => {\n    const { locale, payload } = req\n    const { defaultLocale = DEFAULT_LOCALE } = payload.config.localization || {}\n    const currentLocale = locale || defaultLocale || 'en'\n    const useNestedDocs = pluginConfig.nestedDocsPlugin !== undefined\n\n    // Generate the base URL\n    const baseUrl = generateUrl(config, data, useNestedDocs)\n\n    // Resolve the final URL by appending locale if needed\n    const resolvedUrl = resolveFinalUrl({\n      appendTo: pluginConfig.options?.appendLocaleToUrl,\n      baseUrl,\n      defaultLocale,\n      locale: currentLocale,\n    })\n\n    return {\n      ...data,\n      [config.fieldName]: resolvedUrl,\n    }\n  }\n\nconst generateUrl = (config: UrlFieldConfig, data: Partial<any>, useNestedDocs: boolean) => {\n  // Generate URL if `generateUrl` function is provided\n  const generatedUrl = typeof config.generateUrl === 'function' ? config.generateUrl(data) : ''\n\n  // Handle nested docs logic\n  if (useNestedDocs) {\n    const breadcrumbs = Array.isArray(data.breadcrumbs) ? data.breadcrumbs : []\n    const nestedUrl = breadcrumbs.reverse()[0]?.url || ''\n    return nestedUrl || generatedUrl\n  }\n\n  return generatedUrl\n}\n\nconst resolveFinalUrl = ({\n  appendTo = 'none',\n  baseUrl,\n  defaultLocale,\n  locale,\n}: {\n  appendTo: AppendLocaleToUrlOptions | undefined\n  baseUrl: string\n  defaultLocale: string\n  locale: string\n}): string => {\n  switch (appendTo) {\n    case 'all':\n      return `/${locale}${baseUrl}`\n    case 'exclude-default':\n      return locale === defaultLocale ? baseUrl : `/${locale}${baseUrl}`\n    default:\n      return baseUrl\n  }\n}\n"],"names":["DEFAULT_LOCALE","resolveUrl","pluginConfig","config","data","req","locale","payload","defaultLocale","localization","currentLocale","useNestedDocs","nestedDocsPlugin","undefined","baseUrl","generateUrl","resolvedUrl","resolveFinalUrl","appendTo","options","appendLocaleToUrl","fieldName","generatedUrl","breadcrumbs","Array","isArray","nestedUrl","reverse","url"],"mappings":"AAIA,SAASA,cAAc,QAAQ,kBAAiB;AAEhD,OAAO,MAAMC,aACX,CAACC,cAAsCC,SACvC,CAAC,EAAEC,IAAI,EAAEC,GAAG,EAAE;QACZ,MAAM,EAAEC,MAAM,EAAEC,OAAO,EAAE,GAAGF;QAC5B,MAAM,EAAEG,gBAAgBR,cAAc,EAAE,GAAGO,QAAQJ,MAAM,CAACM,YAAY,IAAI,CAAC;QAC3E,MAAMC,gBAAgBJ,UAAUE,iBAAiB;QACjD,MAAMG,gBAAgBT,aAAaU,gBAAgB,KAAKC;QAExD,wBAAwB;QACxB,MAAMC,UAAUC,YAAYZ,QAAQC,MAAMO;QAE1C,sDAAsD;QACtD,MAAMK,cAAcC,gBAAgB;YAClCC,UAAUhB,aAAaiB,OAAO,EAAEC;YAChCN;YACAN;YACAF,QAAQI;QACV;QAEA,OAAO;YACL,GAAGN,IAAI;YACP,CAACD,OAAOkB,SAAS,CAAC,EAAEL;QACtB;IACF,EAAC;AAEH,MAAMD,cAAc,CAACZ,QAAwBC,MAAoBO;IAC/D,qDAAqD;IACrD,MAAMW,eAAe,OAAOnB,OAAOY,WAAW,KAAK,aAAaZ,OAAOY,WAAW,CAACX,QAAQ;IAE3F,2BAA2B;IAC3B,IAAIO,eAAe;QACjB,MAAMY,cAAcC,MAAMC,OAAO,CAACrB,KAAKmB,WAAW,IAAInB,KAAKmB,WAAW,GAAG,EAAE;QAC3E,MAAMG,YAAYH,YAAYI,OAAO,EAAE,CAAC,EAAE,EAAEC,OAAO;QACnD,OAAOF,aAAaJ;IACtB;IAEA,OAAOA;AACT;AAEA,MAAML,kBAAkB,CAAC,EACvBC,WAAW,MAAM,EACjBJ,OAAO,EACPN,aAAa,EACbF,MAAM,EAMP;IACC,OAAQY;QACN,KAAK;YACH,OAAO,CAAC,CAAC,EAAEZ,SAASQ,SAAS;QAC/B,KAAK;YACH,OAAOR,WAAWE,gBAAgBM,UAAU,CAAC,CAAC,EAAER,SAASQ,SAAS;QACpE;YACE,OAAOA;IACX;AACF"}