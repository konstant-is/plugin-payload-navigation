{"version":3,"sources":["../../src/hooks/resolveLocalizedUrls.ts"],"sourcesContent":["import type { CollectionBeforeChangeHook } from 'payload'\nimport type { PluginContext } from 'src/utils/createPluginContext.js'\n\nexport const resolveLocalizedUrl =\n  (context: PluginContext): CollectionBeforeChangeHook =>\n  ({ data, operation, req }) => {\n    const { locale, payload } = req\n    const { defaultLocale = context.fallbackLocale } = payload.config.localization || {}\n    const currentLocale = locale || defaultLocale\n    const { localizedUrlFieldConfig } = context.fieldConfigs\n    if (operation === 'create') {\n      return data\n    }\n\n    const sourceField = localizedUrlFieldConfig.sourceField\n      ? data[localizedUrlFieldConfig.sourceField]\n      : undefined\n\n    if (!sourceField) {\n      payload.logger.error(\n        `Error: Missing source field \"${localizedUrlFieldConfig.sourceField}\" while resolving localized url.`,\n      )\n\n      return data\n    }\n\n    const field = data[localizedUrlFieldConfig.fieldName] || {}\n    if (typeof field !== 'object') {\n      payload.logger.error(\n        `Error: Localized url field \"${localizedUrlFieldConfig.fieldName}\" is not an object.`,\n      )\n      return data\n    }\n\n    const updated = {\n      ...field,\n      [currentLocale]: sourceField,\n    }\n\n    return {\n      ...data,\n      [localizedUrlFieldConfig.fieldName]: updated,\n    }\n  }\n"],"names":["resolveLocalizedUrl","context","data","operation","req","locale","payload","defaultLocale","fallbackLocale","config","localization","currentLocale","localizedUrlFieldConfig","fieldConfigs","sourceField","undefined","logger","error","field","fieldName","updated"],"mappings":"AAGA,OAAO,MAAMA,sBACX,CAACC,UACD,CAAC,EAAEC,IAAI,EAAEC,SAAS,EAAEC,GAAG,EAAE;QACvB,MAAM,EAAEC,MAAM,EAAEC,OAAO,EAAE,GAAGF;QAC5B,MAAM,EAAEG,gBAAgBN,QAAQO,cAAc,EAAE,GAAGF,QAAQG,MAAM,CAACC,YAAY,IAAI,CAAC;QACnF,MAAMC,gBAAgBN,UAAUE;QAChC,MAAM,EAAEK,uBAAuB,EAAE,GAAGX,QAAQY,YAAY;QACxD,IAAIV,cAAc,UAAU;YAC1B,OAAOD;QACT;QAEA,MAAMY,cAAcF,wBAAwBE,WAAW,GACnDZ,IAAI,CAACU,wBAAwBE,WAAW,CAAC,GACzCC;QAEJ,IAAI,CAACD,aAAa;YAChBR,QAAQU,MAAM,CAACC,KAAK,CAClB,CAAC,6BAA6B,EAAEL,wBAAwBE,WAAW,CAAC,gCAAgC,CAAC;YAGvG,OAAOZ;QACT;QAEA,MAAMgB,QAAQhB,IAAI,CAACU,wBAAwBO,SAAS,CAAC,IAAI,CAAC;QAC1D,IAAI,OAAOD,UAAU,UAAU;YAC7BZ,QAAQU,MAAM,CAACC,KAAK,CAClB,CAAC,4BAA4B,EAAEL,wBAAwBO,SAAS,CAAC,mBAAmB,CAAC;YAEvF,OAAOjB;QACT;QAEA,MAAMkB,UAAU;YACd,GAAGF,KAAK;YACR,CAACP,cAAc,EAAEG;QACnB;QAEA,OAAO;YACL,GAAGZ,IAAI;YACP,CAACU,wBAAwBO,SAAS,CAAC,EAAEC;QACvC;IACF,EAAC"}