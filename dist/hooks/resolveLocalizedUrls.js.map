{"version":3,"sources":["../../src/hooks/resolveLocalizedUrls.ts"],"sourcesContent":["import type { CollectionBeforeChangeHook } from 'payload'\n\nimport type { LocalizedUrlFieldConfig } from '../types.js'\n\nimport { DEFAULT_LOCALE } from '../constants.js'\n\nexport const resolveLocalizedUrl =\n  (config: LocalizedUrlFieldConfig): CollectionBeforeChangeHook =>\n  ({ data, operation, req }) => {\n    const { locale, payload } = req\n    const { defaultLocale = DEFAULT_LOCALE } = payload.config.localization || {}\n    const currentLocale = locale || defaultLocale || 'en'\n\n    if (operation === 'create') {\n      return data\n    }\n\n    const sourceField = config.sourceField ? data[config.sourceField] : undefined\n    if (!sourceField) {\n      payload.logger.error(\n        `Error: Missing source field \"${config.sourceField}\" while resolving localized url.`,\n      )\n\n      return data\n    }\n\n    const field = data[config.fieldName] || {}\n    if (typeof field !== 'object') {\n      payload.logger.error(`Error: Localized url field \"${config.fieldName}\" is not an object.`)\n      return data\n    }\n\n    const updated = {\n      ...field,\n      [currentLocale]: sourceField,\n    }\n\n    return {\n      ...data,\n      [config.fieldName]: updated,\n    }\n  }\n"],"names":["DEFAULT_LOCALE","resolveLocalizedUrl","config","data","operation","req","locale","payload","defaultLocale","localization","currentLocale","sourceField","undefined","logger","error","field","fieldName","updated"],"mappings":"AAIA,SAASA,cAAc,QAAQ,kBAAiB;AAEhD,OAAO,MAAMC,sBACX,CAACC,SACD,CAAC,EAAEC,IAAI,EAAEC,SAAS,EAAEC,GAAG,EAAE;QACvB,MAAM,EAAEC,MAAM,EAAEC,OAAO,EAAE,GAAGF;QAC5B,MAAM,EAAEG,gBAAgBR,cAAc,EAAE,GAAGO,QAAQL,MAAM,CAACO,YAAY,IAAI,CAAC;QAC3E,MAAMC,gBAAgBJ,UAAUE,iBAAiB;QAEjD,IAAIJ,cAAc,UAAU;YAC1B,OAAOD;QACT;QAEA,MAAMQ,cAAcT,OAAOS,WAAW,GAAGR,IAAI,CAACD,OAAOS,WAAW,CAAC,GAAGC;QACpE,IAAI,CAACD,aAAa;YAChBJ,QAAQM,MAAM,CAACC,KAAK,CAClB,CAAC,6BAA6B,EAAEZ,OAAOS,WAAW,CAAC,gCAAgC,CAAC;YAGtF,OAAOR;QACT;QAEA,MAAMY,QAAQZ,IAAI,CAACD,OAAOc,SAAS,CAAC,IAAI,CAAC;QACzC,IAAI,OAAOD,UAAU,UAAU;YAC7BR,QAAQM,MAAM,CAACC,KAAK,CAAC,CAAC,4BAA4B,EAAEZ,OAAOc,SAAS,CAAC,mBAAmB,CAAC;YACzF,OAAOb;QACT;QAEA,MAAMc,UAAU;YACd,GAAGF,KAAK;YACR,CAACL,cAAc,EAAEC;QACnB;QAEA,OAAO;YACL,GAAGR,IAAI;YACP,CAACD,OAAOc,SAAS,CAAC,EAAEC;QACtB;IACF,EAAC"}