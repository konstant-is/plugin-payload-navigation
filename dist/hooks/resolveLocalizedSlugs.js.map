{"version":3,"sources":["../../src/hooks/resolveLocalizedSlugs.ts"],"sourcesContent":["import type { CollectionBeforeChangeHook } from 'payload'\n\nimport type { LocalizedSlugFieldConfig } from '../types.js'\n\nimport { DEFAULT_LOCALE } from '../constants.js'\n\nexport const resolveLocalizedSlugs =\n  (config: LocalizedSlugFieldConfig): CollectionBeforeChangeHook =>\n  ({ data, operation, req }) => {\n    const { locale, payload } = req\n    const { defaultLocale = DEFAULT_LOCALE } = payload.config.localization || {}\n    const currentLocale = locale || defaultLocale\n\n    if (operation === 'create') {\n      return data\n    }\n\n    // Fetch source field value\n    const sourceField = config.sourceField ? data[config.sourceField] : undefined\n    if (!sourceField) {\n      payload.logger.error(\n        `Error: Missing source field \"${config.sourceField}\" while populating localized slugs.`,\n      )\n\n      return data\n    }\n\n    // Fetch or initialize the localized slugs field\n    const localizedSlugField = data[config.fieldName] || {}\n    if (typeof localizedSlugField !== 'object') {\n      payload.logger.error(`Error: Localized slugs field \"${config.fieldName}\" is not an object.`)\n      return data\n    }\n\n    // Update the localized field with the current locale's slug\n    const updatedLocalizedField = {\n      ...localizedSlugField,\n      [currentLocale]: sourceField,\n    }\n\n    // Log successful operation\n    payload.logger.info(\n      `Localized slug updated for locale \"${currentLocale}\" in field \"${config.fieldName}\".`,\n    )\n\n    return {\n      ...data,\n      [config.fieldName]: updatedLocalizedField,\n    }\n  }\n"],"names":["DEFAULT_LOCALE","resolveLocalizedSlugs","config","data","operation","req","locale","payload","defaultLocale","localization","currentLocale","sourceField","undefined","logger","error","localizedSlugField","fieldName","updatedLocalizedField","info"],"mappings":"AAIA,SAASA,cAAc,QAAQ,kBAAiB;AAEhD,OAAO,MAAMC,wBACX,CAACC,SACD,CAAC,EAAEC,IAAI,EAAEC,SAAS,EAAEC,GAAG,EAAE;QACvB,MAAM,EAAEC,MAAM,EAAEC,OAAO,EAAE,GAAGF;QAC5B,MAAM,EAAEG,gBAAgBR,cAAc,EAAE,GAAGO,QAAQL,MAAM,CAACO,YAAY,IAAI,CAAC;QAC3E,MAAMC,gBAAgBJ,UAAUE;QAEhC,IAAIJ,cAAc,UAAU;YAC1B,OAAOD;QACT;QAEA,2BAA2B;QAC3B,MAAMQ,cAAcT,OAAOS,WAAW,GAAGR,IAAI,CAACD,OAAOS,WAAW,CAAC,GAAGC;QACpE,IAAI,CAACD,aAAa;YAChBJ,QAAQM,MAAM,CAACC,KAAK,CAClB,CAAC,6BAA6B,EAAEZ,OAAOS,WAAW,CAAC,mCAAmC,CAAC;YAGzF,OAAOR;QACT;QAEA,gDAAgD;QAChD,MAAMY,qBAAqBZ,IAAI,CAACD,OAAOc,SAAS,CAAC,IAAI,CAAC;QACtD,IAAI,OAAOD,uBAAuB,UAAU;YAC1CR,QAAQM,MAAM,CAACC,KAAK,CAAC,CAAC,8BAA8B,EAAEZ,OAAOc,SAAS,CAAC,mBAAmB,CAAC;YAC3F,OAAOb;QACT;QAEA,4DAA4D;QAC5D,MAAMc,wBAAwB;YAC5B,GAAGF,kBAAkB;YACrB,CAACL,cAAc,EAAEC;QACnB;QAEA,2BAA2B;QAC3BJ,QAAQM,MAAM,CAACK,IAAI,CACjB,CAAC,mCAAmC,EAAER,cAAc,YAAY,EAAER,OAAOc,SAAS,CAAC,EAAE,CAAC;QAGxF,OAAO;YACL,GAAGb,IAAI;YACP,CAACD,OAAOc,SAAS,CAAC,EAAEC;QACtB;IACF,EAAC"}