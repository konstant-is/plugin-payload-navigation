{"version":3,"sources":["../../src/hooks/resolveLocalizedSlugs.ts"],"sourcesContent":["import type { CollectionBeforeChangeHook } from 'payload'\n\nimport type { PluginContext } from '../utils/createPluginContext.js'\n\nexport const resolveLocalizedSlugs =\n  (context: PluginContext): CollectionBeforeChangeHook =>\n  ({ data, operation, req }) => {\n    const { locale, payload } = req\n    const { defaultLocale = context.fallbackLocale } = payload.config.localization || {}\n    const currentLocale = locale || defaultLocale\n\n    const { localizedSlugFieldConfig } = context.fieldConfigs\n    if (operation === 'create') {\n      return data\n    }\n\n    // Fetch source field value\n    const sourceField = localizedSlugFieldConfig.sourceField\n      ? data[localizedSlugFieldConfig.sourceField]\n      : undefined\n\n    if (!sourceField) {\n      payload.logger.error(\n        `Error: Missing source field \"${localizedSlugFieldConfig.sourceField}\" while populating localized slugs.`,\n      )\n\n      return data\n    }\n\n    // Fetch or initialize the localized slugs field\n    const localizedSlugField = data[localizedSlugFieldConfig.fieldName] || {}\n    if (typeof localizedSlugField !== 'object') {\n      payload.logger.error(\n        `Error: Localized slugs field \"${localizedSlugFieldConfig.fieldName}\" is not an object.`,\n      )\n      return data\n    }\n\n    // Update the localized field with the current locale's slug\n    const updatedLocalizedField = {\n      ...localizedSlugField,\n      [currentLocale]: sourceField,\n    }\n\n    return {\n      ...data,\n      [localizedSlugFieldConfig.fieldName]: updatedLocalizedField,\n    }\n  }\n"],"names":["resolveLocalizedSlugs","context","data","operation","req","locale","payload","defaultLocale","fallbackLocale","config","localization","currentLocale","localizedSlugFieldConfig","fieldConfigs","sourceField","undefined","logger","error","localizedSlugField","fieldName","updatedLocalizedField"],"mappings":"AAIA,OAAO,MAAMA,wBACX,CAACC,UACD,CAAC,EAAEC,IAAI,EAAEC,SAAS,EAAEC,GAAG,EAAE;QACvB,MAAM,EAAEC,MAAM,EAAEC,OAAO,EAAE,GAAGF;QAC5B,MAAM,EAAEG,gBAAgBN,QAAQO,cAAc,EAAE,GAAGF,QAAQG,MAAM,CAACC,YAAY,IAAI,CAAC;QACnF,MAAMC,gBAAgBN,UAAUE;QAEhC,MAAM,EAAEK,wBAAwB,EAAE,GAAGX,QAAQY,YAAY;QACzD,IAAIV,cAAc,UAAU;YAC1B,OAAOD;QACT;QAEA,2BAA2B;QAC3B,MAAMY,cAAcF,yBAAyBE,WAAW,GACpDZ,IAAI,CAACU,yBAAyBE,WAAW,CAAC,GAC1CC;QAEJ,IAAI,CAACD,aAAa;YAChBR,QAAQU,MAAM,CAACC,KAAK,CAClB,CAAC,6BAA6B,EAAEL,yBAAyBE,WAAW,CAAC,mCAAmC,CAAC;YAG3G,OAAOZ;QACT;QAEA,gDAAgD;QAChD,MAAMgB,qBAAqBhB,IAAI,CAACU,yBAAyBO,SAAS,CAAC,IAAI,CAAC;QACxE,IAAI,OAAOD,uBAAuB,UAAU;YAC1CZ,QAAQU,MAAM,CAACC,KAAK,CAClB,CAAC,8BAA8B,EAAEL,yBAAyBO,SAAS,CAAC,mBAAmB,CAAC;YAE1F,OAAOjB;QACT;QAEA,4DAA4D;QAC5D,MAAMkB,wBAAwB;YAC5B,GAAGF,kBAAkB;YACrB,CAACP,cAAc,EAAEG;QACnB;QAEA,OAAO;YACL,GAAGZ,IAAI;YACP,CAACU,yBAAyBO,SAAS,CAAC,EAAEC;QACxC;IACF,EAAC"}